---
layout: "tfe"
page_title: "Terraform Enterprise: tfe_workspace_run"
description: |-
  Manages run create and destroy lifecycles in a workspace.
---


<!-- Please do not edit this file, it is generated. -->
# tfe_workspace_run

Provides a resource to manage the _initial_ and/or _final_ Terraform run in a given workspace. These initial and final runs often have a special relationship to other things that depend on the workspace's existence, so it can be useful to manage the completion of these runs in the same Terraform configuration that manages the workspace.

There are a few main use cases this resource was designed for:

- **Workspaces that depend on other workspaces.** If a workspace will create infrastructure that other workspaces rely on (for example, a Kubernetes cluster to deploy resources into), those downstream workspaces can depend on an initial `Apply` with `wait_for_run = true`, so they aren't created before their infrastructure dependencies.
- **A more reliable `queue_all_runs = true`.** The `QueueAllRuns` argument on `TfeWorkspace` requests an initial run, which can complete asynchronously outside of the Terraform run that creates the workspace. Unfortunately, it can't be used with workspaces that require variables to be set, because the `TfeVariable` resources themselves depend on the `TfeWorkspace`. By managing an initial `Apply` with `wait_for_run = false` that depends on your `TfeVariables`, you can accomplish the same goal without a circular dependency.
- **Safe workspace destruction.** To ensure a workspace's managed resources are destroyed before deleting it, add a `Destroy` block with `wait_for_run = true`. When you destroy the `TfeWorkspaceRun` resource, Terraform will wait for the destroy run to complete before deleting the workspace. This pattern is compatible with the `TfeWorkspace` resource's default safe deletion behavior.

The `TfeWorkspaceRun` expects to own exactly one apply during a creation and/or one destroy during a destruction. This implies that even if previous successful applies exist in the workspace, a `TfeWorkspaceRun` resource that includes an `Apply` block will queue a new apply when added to a config.

~> **NOTE:** Use caution when removing the `TfeWorkspaceRun` resource from your configuration, as destroying it with a `Destroy` block present will create a destroy run which will destroy the workspace's underlying managed resources. To avoid this behavior, remove the `Destroy` block first.

## Example Usage

Basic usage with multiple workspaces:

```go
import constructs "github.com/aws/constructs-go/constructs"
import "github.com/hashicorp/terraform-cdk-go/cdktf"
/*Provider bindings are generated by running cdktf get.
See https://cdk.tf/provider-generation for more details.*/
import "github.com/aws-samples/dummy/gen/providers/tfe/organization"
import "github.com/aws-samples/dummy/gen/providers/tfe/oauthClient"
import "github.com/aws-samples/dummy/gen/providers/tfe/workspace"
import "github.com/aws-samples/dummy/gen/providers/tfe/workspaceRun"
type myConvertedCode struct {
	terraformStack
}

func newMyConvertedCode(scope construct, name *string) *myConvertedCode {
	this := &myConvertedCode{}
	cdktf.NewTerraformStack_Override(this, scope, name)
	tfeOrganizationTestOrganization := organization.NewOrganization(this, jsii.String("test-organization"), &organizationConfig{
		email: jsii.String("admin@company.com"),
		name: jsii.String("my-org-name"),
	})
	tfeOauthClientTest := oauthClient.NewOauthClient(this, jsii.String("test"), &oauthClientConfig{
		apiUrl: jsii.String("https://api.github.com"),
		httpUrl: jsii.String("https://github.com"),
		oauthToken: jsii.String("oauth_token_id"),
		organization: tfeOrganizationTestOrganization,
		serviceProvider: jsii.String("github"),
	})
	tfeWorkspaceChild := workspace.NewWorkspace(this, jsii.String("child"), &workspaceConfig{
		name: jsii.String("child-ws"),
		organization: tfeOrganizationTestOrganization,
		queueAllRuns: jsii.Boolean(false),
		vcsRepo: &workspaceVcsRepo{
			branch: jsii.String("main"),
			identifier: jsii.String("my-org-name/vcs-repository"),
			oauthTokenId: cdktf.Token_AsString(tfeOauthClientTest.oauthTokenId),
		},
	})
	tfeWorkspaceParent := workspace.NewWorkspace(this, jsii.String("parent"), &workspaceConfig{
		name: jsii.String("parent-ws"),
		organization: tfeOrganizationTestOrganization,
		queueAllRuns: jsii.Boolean(false),
		vcsRepo: &workspaceVcsRepo{
			branch: jsii.String("main"),
			identifier: jsii.String("my-org-name/vcs-repository"),
			oauthTokenId: cdktf.Token_*AsString(tfeOauthClientTest.oauthTokenId),
		},
	})
	tfeWorkspaceRunWsRunParent := workspaceRun.NewWorkspaceRun(this, jsii.String("ws_run_parent"), &workspaceRunConfig{
		apply: &workspaceRunApply{
			manualConfirm: jsii.Boolean(false),
			retryAttempts: jsii.Number(5),
			retryBackoffMin: jsii.Number(5),
			waitForRun: jsii.Boolean(true),
		},
		destroy: &workspaceRunDestroy{
			manualConfirm: jsii.Boolean(false),
			retryAttempts: jsii.Number(3),
			retryBackoffMin: jsii.Number(10),
			waitForRun: jsii.Boolean(true),
		},
		workspaceId: cdktf.Token_*AsString(tfeWorkspaceParent.id),
	})
	workspaceRun.NewWorkspaceRun(this, jsii.String("ws_run_child"), &workspaceRunConfig{
		apply: &workspaceRunApply{
			manualConfirm: jsii.Boolean(false),
			retryAttempts: jsii.Number(5),
			retryBackoffMin: jsii.Number(5),
		},
		dependsOn: []iTerraformDependable{
			tfeWorkspaceRunWsRunParent,
		},
		destroy: &workspaceRunDestroy{
			manualConfirm: jsii.Boolean(false),
			retryAttempts: jsii.Number(3),
			retryBackoffMin: jsii.Number(10),
			waitForRun: jsii.Boolean(true),
		},
		workspaceId: cdktf.Token_*AsString(tfeWorkspaceChild.id),
	})
	return this
}
```

With manual confirmation:

```go
import constructs "github.com/aws/constructs-go/constructs"
import "github.com/hashicorp/terraform-cdk-go/cdktf"
/*Provider bindings are generated by running cdktf get.
See https://cdk.tf/provider-generation for more details.*/
import "github.com/aws-samples/dummy/gen/providers/tfe/organization"
import "github.com/aws-samples/dummy/gen/providers/tfe/oauthClient"
import "github.com/aws-samples/dummy/gen/providers/tfe/workspace"
import "github.com/aws-samples/dummy/gen/providers/tfe/workspaceRun"
type myConvertedCode struct {
	terraformStack
}

func newMyConvertedCode(scope construct, name *string) *myConvertedCode {
	this := &myConvertedCode{}
	cdktf.NewTerraformStack_Override(this, scope, name)
	tfeOrganizationTestOrganization := organization.NewOrganization(this, jsii.String("test-organization"), &organizationConfig{
		email: jsii.String("admin@company.com"),
		name: jsii.String("my-org-name"),
	})
	tfeOauthClientTest := oauthClient.NewOauthClient(this, jsii.String("test"), &oauthClientConfig{
		apiUrl: jsii.String("https://api.github.com"),
		httpUrl: jsii.String("https://github.com"),
		oauthToken: jsii.String("oauth_token_id"),
		organization: tfeOrganizationTestOrganization,
		serviceProvider: jsii.String("github"),
	})
	tfeWorkspaceParent := workspace.NewWorkspace(this, jsii.String("parent"), &workspaceConfig{
		name: jsii.String("parent-ws"),
		organization: tfeOrganizationTestOrganization,
		queueAllRuns: jsii.Boolean(false),
		vcsRepo: &workspaceVcsRepo{
			branch: jsii.String("main"),
			identifier: jsii.String("my-org-name/vcs-repository"),
			oauthTokenId: cdktf.Token_AsString(tfeOauthClientTest.oauthTokenId),
		},
	})
	workspaceRun.NewWorkspaceRun(this, jsii.String("ws_run_parent"), &workspaceRunConfig{
		apply: &workspaceRunApply{
			manualConfirm: jsii.Boolean(true),
		},
		destroy: &workspaceRunDestroy{
			manualConfirm: jsii.Boolean(true),
			waitForRun: jsii.Boolean(true),
		},
		workspaceId: cdktf.Token_*AsString(tfeWorkspaceParent.id),
	})
	return this
}
```

With no retries:

```go
import constructs "github.com/aws/constructs-go/constructs"
import "github.com/hashicorp/terraform-cdk-go/cdktf"
/*Provider bindings are generated by running cdktf get.
See https://cdk.tf/provider-generation for more details.*/
import "github.com/aws-samples/dummy/gen/providers/tfe/organization"
import "github.com/aws-samples/dummy/gen/providers/tfe/oauthClient"
import "github.com/aws-samples/dummy/gen/providers/tfe/workspace"
import "github.com/aws-samples/dummy/gen/providers/tfe/workspaceRun"
type myConvertedCode struct {
	terraformStack
}

func newMyConvertedCode(scope construct, name *string) *myConvertedCode {
	this := &myConvertedCode{}
	cdktf.NewTerraformStack_Override(this, scope, name)
	tfeOrganizationTestOrganization := organization.NewOrganization(this, jsii.String("test-organization"), &organizationConfig{
		email: jsii.String("admin@company.com"),
		name: jsii.String("my-org-name"),
	})
	tfeOauthClientTest := oauthClient.NewOauthClient(this, jsii.String("test"), &oauthClientConfig{
		apiUrl: jsii.String("https://api.github.com"),
		httpUrl: jsii.String("https://github.com"),
		oauthToken: jsii.String("oauth_token_id"),
		organization: tfeOrganizationTestOrganization,
		serviceProvider: jsii.String("github"),
	})
	tfeWorkspaceParent := workspace.NewWorkspace(this, jsii.String("parent"), &workspaceConfig{
		name: jsii.String("parent-ws"),
		organization: tfeOrganizationTestOrganization,
		queueAllRuns: jsii.Boolean(false),
		vcsRepo: &workspaceVcsRepo{
			branch: jsii.String("main"),
			identifier: jsii.String("my-org-name/vcs-repository"),
			oauthTokenId: cdktf.Token_AsString(tfeOauthClientTest.oauthTokenId),
		},
	})
	workspaceRun.NewWorkspaceRun(this, jsii.String("ws_run_parent"), &workspaceRunConfig{
		apply: &workspaceRunApply{
			manualConfirm: jsii.Boolean(false),
			retry: jsii.Boolean(false),
		},
		destroy: &workspaceRunDestroy{
			manualConfirm: jsii.Boolean(false),
			retry: jsii.Boolean(false),
			waitForRun: jsii.Boolean(true),
		},
		workspaceId: cdktf.Token_*AsString(tfeWorkspaceParent.id),
	})
	return this
}
```

## Argument Reference

The following arguments are supported:

* `WorkspaceId` - (Required) ID of the workspace to execute the run.
* `Apply` - (Optional) Adding an apply block ensures an apply run is queued when the resource is created. The block controls settings for the workspace's apply run during creation. 
* `Destroy` - (Optional) Adding a destroy block ensures a destroy run is queued when the resource is destroyed. The block controls settings for the workspace's destroy run during destruction.

Both `Apply` and `Destroy` block supports:

* `ManualConfirm` - (Required) If set to true a human will have to manually confirm a plan in HCP Terraform's UI to start an apply. If set to false, this resource will be automatically applied. Defaults to `False`.
  * If `WaitForRun` is set to `False`, this auto-apply will be done by HCP Terraform.
  * If `WaitForRun` is set to `True`, the apply will be confirmed by the provider. The exception is the case of policy check soft-failed where a human has to perform an override by manually confirming the plan even though `ManualConfirm` is set to false.
  * Note that this setting will override the workspace's default apply mode. To use the workspace default apply mode, look up the setting for `AutoApply` with the `TfeWorkspace` data source.
* `Retry` - (Optional) Whether or not to retry on plan or apply errors. When set to true, `RetryAttempts` must also be greater than zero inorder for retries to happen. Defaults to `True`.
* `RetryAttempts` - (Optional) The number to retry attempts made after an initial error. Defaults to `3`.
* `RetryBackoffMin` - (Optional) The minimum time in seconds to backoff before attempting a retry. Defaults to `1`.
* `RetryBackoffMax` - (Optional) The maximum time in seconds to backoff before attempting a retry. Defaults to `30`.
* `WaitForRun` - (Optional) Whether or not to wait for a run to reach completion before considering this a success. When set to `False`, the provider considers the `TfeWorkspaceRun` resource to have been created immediately after the run has been queued. When set to `True`, the provider waits for a successful apply on the target workspace to have applied successfully (or if it resulted in a no-change plan). Defaults to `True`.

## Attributes Reference

In addition to all arguments above, the following attributes are exported:

* `Id` - The ID of the run created by this resource. Note, if the resource was created without an `Apply{}` configuration block, then this ID will not refer to a real run in HCP Terraform.

<!-- cache-key: cdktf-0.17.0-pre.15 input-326dcde8ef59895f6cb1224693fc7aa8de53e6795010027c9279e6a1d68b85c8 -->